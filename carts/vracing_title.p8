pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- virtua racing demake
-- â–¤@freds72 â™ª@rubyred â™ª@mavica
-- assets: sega/am2 (tm)

-- vector & tools
function lerp(a,b,t)
	return a*(1-t)+b*t
end

function smoothstep(t)
	t=mid(t,0,1)
	return t*t*(3-2*t)
end

function make_v(a,b)
	return {
		b[1]-a[1],
		b[2]-a[2],
		b[3]-a[3]}
end
function v_clone(v)
	return {v[1],v[2],v[3]}
end
function v_dot(a,b)
	return a[1]*b[1]+a[2]*b[2]+a[3]*b[3]
end
function v_scale(v,scale)
	v[1]*=scale
	v[2]*=scale
	v[3]*=scale
end
function v_add(v,dv,scale)
	scale=scale or 1
	v[1]+=scale*dv[1]
	v[2]+=scale*dv[2]
	v[3]+=scale*dv[3]
end
-- safe vector length
function v_len(v)
	local x,y,z=v[1],v[2],v[3]
	local d=max(max(abs(x),abs(y)),abs(z))
	if(d<0.001) return 0
	x/=d
	y/=d
	z/=d
	return d*(x*x+y*y+z*z)^0.5
end
function v_normz(v)
	local d=v_dot(v,v)
	if d>0.001 then
		d=d^.5
		v[1]/=d
		v[2]/=d
		v[3]/=d
	end
	return d
end
function v_cross(a,b)
	local ax,ay,az=a[1],a[2],a[3]
	local bx,by,bz=b[1],b[2],b[3]
	return {ay*bz-az*by,az*bx-ax*bz,ax*by-ay*bx}
end

function v_lerp(a,b,t)
	return {
		lerp(a[1],b[1],t),
		lerp(a[2],b[2],t),
		lerp(a[3],b[3],t)
	}
end
function v_cross(a,b)
	local ax,ay,az=a[1],a[2],a[3]
	local bx,by,bz=b[1],b[2],b[3]
	return {ay*bz-az*by,az*bx-ax*bz,ax*by-ay*bx}
end
-- x/z orthogonal vector
function v2_ortho(a,scale)
	return {-scale*a[1],0,scale*a[3]}
end

local v_up={0,1,0}

-- quaternion
function make_q(v,angle)
	angle/=2
	-- fix pico sin
	local s=-sin(angle)
	return {v[1]*s,
	        v[2]*s,
	        v[3]*s,
	        cos(angle)}
end
function q_clone(q)
	return {q[1],q[2],q[3],q[4]}
end

function q_x_q(a,b)
	local qax,qay,qaz,qaw=a[1],a[2],a[3],a[4]
	local qbx,qby,qbz,qbw=b[1],b[2],b[3],b[4]
        
	a[1]=qax*qbw+qaw*qbx+qay*qbz-qaz*qby
	a[2]=qay*qbw+qaw*qby+qaz*qbx-qax*qbz
	a[3]=qaz*qbw+qaw*qbz+qax*qby-qay*qbx
	a[4]=qaw*qbw-qax*qbx-qay*qby-qaz*qbz
end
function m_from_q(q)
	local x,y,z,w=q[1],q[2],q[3],q[4]
	local x2,y2,z2=x+x,y+y,z+z
	local xx,xy,xz=x*x2,x*y2,x*z2
	local yy,yz,zz=y*y2,y*z2,z*z2
	local wx,wy,wz=w*x2,w*y2,w*z2

	return {
		1-(yy+zz),xy+wz,xz-wy,0,
		xy-wz,1-(xx+zz),yz+wx,0,
		xz+wy,yz-wx,1-(xx+yy),0,
		0,0,0,1}
end

-- matrix functions
function m_x_v(m,v)
	local x,y,z=v[1],v[2],v[3]
	return {m[1]*x+m[5]*y+m[9]*z+m[13],m[2]*x+m[6]*y+m[10]*z+m[14],m[3]*x+m[7]*y+m[11]*z+m[15]}
end
function m_x_m(a,b)
	local a11,a12,a13,a14=a[1],a[5],a[9],a[13]
	local a21,a22,a23,a24=a[2],a[6],a[10],a[14]
	local a31,a32,a33,a34=a[3],a[7],a[11],a[15]

	local b11,b12,b13,b14=b[1],b[5],b[9],b[13]
	local b21,b22,b23,b24=b[2],b[6],b[10],b[14]
	local b31,b32,b33,b34=b[3],b[7],b[11],b[15]

	return {
			a11*b11+a12*b21+a13*b31,a21*b11+a22*b21+a23*b31,a31*b11+a32*b21+a33*b31,0,
			a11*b12+a12*b22+a13*b32,a21*b12+a22*b22+a23*b32,a31*b12+a32*b22+a33*b32,0,
			a11*b13+a12*b23+a13*b33,a21*b13+a22*b23+a23*b33,a31*b13+a32*b23+a33*b33,0,
			a11*b14+a12*b24+a13*b34+a14,a21*b14+a22*b24+a23*b34+a24,a31*b14+a32*b24+a33*b34+a34,1
		}
end

function m_clone(m)
	local c={}
	for k,v in pairs(m) do
		c[k]=v
	end
	return c
end

function make_m_from_euler(x,y,z)
		local a,b = cos(x),-sin(x)
		local c,d = cos(y),-sin(y)
		local e,f = cos(z),-sin(z)
  
  -- yxz order
  local ce,cf,de,df=c*e,c*f,d*e,d*f
	 return {
	  ce+df*b,a*f,cf*b-de,0,
	  de*b-cf,a*e,df+ce*b,0,
	  a*d,-b,a*c,0,
	  0,0,0,1}
end
function make_m_from_v_angle(up,angle)
	local fwd={-sin(angle),0,cos(angle)}
	local right=v_cross(up,fwd)
	v_normz(right)
	fwd=v_cross(right,up)
	return {
		right[1],right[2],right[3],0,
		up[1],up[2],up[3],0,
		fwd[1],fwd[2],fwd[3],0,
		0,0,0,1
	}
end

function make_m_lookat(from,to)
	local fwd=make_v(from,to)
	v_normz(fwd)
	local right=v_cross(v_up,fwd)
	v_normz(right)
	local up=v_cross(fwd,right)
	return {
		right[1],right[2],right[3],0,
		up[1],up[2],up[3],0,
		fwd[1],fwd[2],fwd[3],0,
		0,0,0,1
	}
end

-- only invert 3x3 part
function m_inv(m)
	m[2],m[5]=m[5],m[2]
	m[3],m[9]=m[9],m[3]
	m[7],m[10]=m[10],m[7]
end
-- inline matrix invert
-- inc. position
function m_inv_x_v(m,v)
	local x,y,z=v[1]-m[13],v[2]-m[14],v[3]-m[15]
	return {m[1]*x+m[2]*y+m[3]*z,m[5]*x+m[6]*y+m[7]*z,m[9]*x+m[10]*y+m[11]*z}
end
function m_set_pos(m,v)
	m[13],m[14],m[15]=v[1],v[2],v[3]
end
-- returns basis vectors from matrix
function m_right(m)
	return {m[1],m[2],m[3]}
end
function m_up(m)
	return {m[5],m[6],m[7]}
end
function m_fwd(m)
	return {m[9],m[10],m[11]}
end

-- coroutine helper
function corun(f)
	local cs=costatus(f)
	if cs=="suspended" then
		assert(coresume(f))
		return f
	end
	return nil
end

-- sort
-- https://github.com/morgan3d/misc/tree/master/p8sort
-- 
function sort(data)
 local n = #data 
 if(n<2) return
 
 -- form a max heap
 for i = flr(n / 2) + 1, 1, -1 do
  -- m is the index of the max child
  local parent, value, m = i, data[i], i + i
  local key = value.key 
  
  while m <= n do
   -- find the max child
   if ((m < n) and (data[m + 1].key > data[m].key)) m += 1
   local mval = data[m]
   if (key > mval.key) break
   data[parent] = mval
   parent = m
   m += m
  end
  data[parent] = value
 end 

 -- read out the values,
 -- restoring the heap property
 -- after each step
 for i = n, 2, -1 do
  -- swap root with last
  local value = data[i]
  data[i], data[1] = data[1], value

  -- restore the heap
  local parent, terminate, m = 1, i - 1, 2
  local key = value.key 
  
  while m <= terminate do
   local mval = data[m]
   local mkey = mval.key
   if (m < terminate) and (data[m + 1].key > mkey) then
    m += 1
    mval = data[m]
    mkey = mval.key
   end
   if (key > mkey) break
   data[parent] = mval
   parent = m
   m += m
  end  
  
  data[parent] = value
 end
end

local sessionid,cam=0
local all_models={}
local k_far,k_near=0,2
local k_right,k_left=4,8
local z_near=0.05

-- camera
function make_cam()
	-- views
	local switching_async
	-- 0: far
	-- 1: close
	local view_mode=1
	-- view offset/angle/lag
	local view_pov={
		{-2.2,1.5,0.2},
		{-0.7,0.3,0.1}
	}
	local current_pov=v_clone(view_pov[view_mode+1])

	local t=0
	return {
		pos={0,0,0},
		angle=0,
		update=function(self)
			t+=1
			if switching_async then
				switching_async=corun(switching_async)
			elseif t%120>30 then
				local next_mode=(view_mode+1)%#view_pov
				local next_pov=v_clone(view_pov[next_mode+1])
				switching_async=cocreate(function()
					for i=0,29 do
						local t=smoothstep(i/30)
						current_pov=v_lerp(view_pov[view_mode+1],next_pov,t)
						yield()
					end
					-- avoid drift
					current_pov,view_mode=next_pov,next_mode
				end)
			end
		end,
		track=function(self,from,to)
			-- lerp position
			local pos=v_lerp(self.pos,from,current_pov[3])
			-- v_normz(up)

			-- shift cam position			
			local m=make_m_lookat(from,to)
			-- v_add(pos,m_fwd(m),current_pov[1])

			local right=m_right(m)
			self.angle=atan2(m[1],m[3])

			-- inverse view matrix
			m_inv(m)
			self.m=m_x_m(m,{
				1,0,0,0,
				0,1,0,0,
				0,0,1,0,
				-pos[1],-pos[2],-pos[3],1
			})
			
			self.pos=pos
		end,
		project_poly=function(self,p,col)
			color(col)
			local p0,nodes=p[#p],{}
			local w0=63.5/p0[3]
			-- band vs. flr: -0.20%
			local x0,y0=63.5+band(0xffff,p0[1]*w0),63.5-band(0xffff,p0[2]*w0)

			for i=1,#p do
				local p1=p[i]
				local w1=63.5/p1[3]
				local x01,y01=63.5+band(0xffff,p1[1]*w1),63.5-band(0xffff,p1[2]*w1)
				-- backup before any swap
				local x1,y1=x01,y01
				if(y0>y1) x0,y0,x1,y1=x1,y1,x0,y0
				local dx=(x1-x0)/(y1-y0)
				if(y0<0) x0-=y0*dx y0=0
				for y=y0,min(y1,128) do
					local x=nodes[y]
					-- any 'other' side?
					if x then
						rectfill(x,y,x0,y)
					else
						-- first pixel on this row
						nodes[y]=x0
					end
					x0+=dx
				end
				-- next vertex
				x0,y0=x01,y01
			end
		end
	}
end

-- game states
-- transition to next state
local states={}

function pop_state()
	assert(#states>0,"missing base state")	
	states[#states]=nil
end

function push_state(state,...)
	add(states,state(...))
end

function title_state()
	local angle,t,loading=0,0
	local cam_pos={5,1,0}
	music(0)
	
	return {
		-- draw
		draw=function()
			local x0=-(cam.angle*128)%128
			map(0,0,x0,0,16,16)
			if x0>0 then
				map(0,0,x0-128,0,16,16)
			end
			
			local out={}
			-- track
			for i=-1,1 do
				local m={
					1,0,0,0,
					0,1,0,0,
					0,0,1,0,
					0,0,12*i-((12*time())%12),1}
			 		collect_model_faces(all_models["track"],m,nil,out)
			end

			sort(out)
			draw_faces(out)

			-- markings
			out={}
			for i=-0.5,0.5 do
				local m={
					1,0,0,0,
					0,1,0,0,
					0,0,1,0,
					0,0,12*i-((12*time())%12),1}
			 		collect_model_faces(all_models["markings"],m,nil,out)
			end
			draw_faces(out)

			-- car
			out={}
			local wheel_m=make_m_from_euler(time(),0,0)
			local actor={
				rrw=wheel_m,
				lrw=wheel_m,
				lfw=wheel_m,
				rfw=wheel_m
			}
			local m={
				1,0,0,0,
				0,1,0,0,
				0,0,1,0,
				cos(time()/5)/3,0,0,1}
			collect_model_faces(all_models["car"],m,actor,out)

			sort(out)
			draw_faces(out)

			print3d(56,96,35,12,108,116,time()/2)			
			printb("code:@FREDS72",nil,2,11)
			printb("music:@mavica+@rubyred",nil,10,3)
			palt(14,true)
			palt(0,false)
			spr(231,2,120,2,1)
			palt()

	  	if(t%32<16) printb("âŽðŸ…¾ï¸ to start",nil,121,10,4)

		end,
		-- update
		update=function(self)
			t+=1
			if not loading and (btnp(4) or btnp(5)) then
				-- avoid reentrancy bug
				loading=true
				music(-1,500)
				push_state(slidein_state,selection_state)
			end
			if t%120==0 then
				cam_pos={rnd(4)-2,1,rnd(4)-2}
			end
			local angle=time()/8			
			cam:track({-sin(angle),0.2,cos(angle)},{0,0,0})
		end
	}
end

local vrtext="111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111117111111177777777111177771111111177711111777777771111117711111111777777117777777777777777117777771111111111111111111111111111111111111111777777771111777711111111777111117777777711111117111111117777771177777777777777777777777711111117111111111111111111111111111111117777777711117777111111117771111177777777111111171111111177777711777777777777777777777777111117771111111111111111111111111111111177777777111777771111111177771111777777771111111711111111777777117777777777777777777777771111777711111111111111111111111111111111777777711117777711111111777711117777777711111111111111117777771177777777777777777777777711177777111111111111111111111111111111117777777111177777111111117777111177777777111111111111111177777711777777777777777777777777117777771111111111111111111111111111111177777771117778888818881177777118778777771111111111111111777777117777777777777777777777771177777711111111111111111111111111111111777777111177888788008881777771081088877711111111111111117777771177777777777777777777777717777777111111111111111111111111111111117777771111708887011088817777710010888777111111111111111177777711777777777777777777777777177777771111111111111111111111111111111177777111177888878810888887888718888888781118881181111888777888881177777711111111777777711777777711111111111111111111111111111111777771111708887788100888888887088888880011088810881108887788888811777777111111117777711117777777111111111111111111111111111111117777711117088877881108880088870800888770110888108881088870888000117777771111111177777111177777771111111111111111111111111111111177771111878888778811088870888708108887771108881100110888708888801177777711111111777771111777777711111111111111111111111111111111777711118088877788110088708887081088877711088811881108887088888811777777111111117777771117777777111111111111111111111111111111117777111180888777881110887088870810888777110888118881088870888008117777771111111177777777177777771111111111111111111111111111111177711111888877778811100870888708108887771108881188810888708887007777777777777777777777771177777711111111111111111111111111111111777111118888777788111108708887088888877788888811888108887088888877777777777777777777777711777777111111111111111111111111111111117771111188887777881111087088870888881777088881108811088870888088777777777777777777777777111777771111111111111111111111111111111177111111000777770111110070007700000117770000111001110001700070007777777777777777777777771111777711111111111111111111111111111111771111117777777771111177777777771111177711111111111111117777771177777777777777777777777711111777111111111111111111111111111111117111111177777777711111777777777711111177111111111111111177777711777777777777777777777777111111771111111111111111111111111111111171111111777777777111117777777777111111778881111111188888777777117777777787777777777777881111111111111111111111111111111111111111711111117777777777111777777777771111117788811111118888887777771177777777877777771177708811111111111111111111111111111111111111111111111177777777771117777777777711111117888111111088800077777711777777777777777717777000111111111111111111111111111111111111111111111111777777777711177777777777111111178881111110888110888887118877777887777888788877881111888888818881111111111111111111111111111111117777777777711777777777771111111188811111108881108888881188877788877788888888708811188888888888881111111011111111111111111111111177777771777177777777777711111111888111111008888880008881888870888778880008887088810888008888008811111110111111111111111111111111777777717771777777777777111111118881111111008888888000110888708887000110088870888108887788811088111111101111111111111111111111117777771177717777177777771111111188811111111888008888881108887088871111110888708881088877888110881111111011111111111111111111111177777711777777771777777777111111888777771108881080088881088870888111111108887088810888778881108877777770111111111111111111111111777777117777777717777777771111118887777711888110870088818888708881188811088870888108887788881088777777701111111111111111111111117777711177777777117777777711111188877777108881108888888188877088810088880888708811088877888888887777777011111111111111111111111177777111777777771177777777111111888777771888111080888811887770888110088808887088110888778880888177777770111111111111111111111111777771117777777711777777771111110077777700011110700007110177700011110000000770001100077788800011777777701111111111111111111111117777111177777777111777777711111177777777111111177777771111777777111111117777771187777777088888887777777011111111111111111111111177771111777777771117777777111111777777771111111777777711117777771111111177777711177777770088888877777777111111111111111111111111777111117777777711117777771111117777777711111117777777111177777711111111777771117777777770000001777777771111111111111111111111117771111177777777111177777711111177777777111111177777771111777777111111117777711177777777777111177777777711111111111111111111111177711111777777771111777777111111777777771111111777777711117777771111111177771111777777777771111777777777111111111111111111111111771111117777777711111777771111117777777711111117777777111177777711111111777111117777777777711177777777771111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000"
local vrbytes={}
for i=1,#vrtext,8 do
	add(vrbytes,tonum("0x"..sub(vrtext,i,i+3).."."..sub(vrtext,i+4,i+7)))
end
function draw_slide(t)
	t=smoothstep(t)
	local rows=flr(64*t)
	local skip_rows=63-rows
	local mem=0x6000
	for i=0,rows-1 do
		for k=0,15 do
			poke4(mem,vrbytes[(skip_rows+i)*16+k+1])
			mem+=4
		end
	end
	local mem=0x6000+(128-rows)*64
	for i=0,rows-1 do
		for k=0,15 do
			poke4(mem,vrbytes[(64+i)*16+k+1])
			mem+=4
		end
	end
end

function slidein_state(after_state,params)	
	local ttl=20
	return {
		-- draw
		draw=function()
			draw_slide(1-ttl/20)
		end,
		update=function(self)
			ttl-=1
			if ttl<0 then
				-- current background
				pop_state()
				-- self
				pop_state()
				-- next active
				push_state(after_state,params)
				-- transition
				push_state(slideout_state)
			end
		end
	}
end

function slideout_state()
	local ttl=20
	return {
		-- draw
		draw=function()
			draw_slide(ttl/20)
		end,
		update=function(self)
			ttl-=1
			if ttl<0 then
				pop_state()
			end
		end
	}
end

function selection_state()
	local track,t,loading=0,0
 	local track_tgt=0
	local blink=true
	local tracks={
		{0,0,level="beginner",c=7,id=0,title="big forest"},
		{54,0,level="medium",c=7,id=2,title="ocean"},
		{0,56,level="expert",c=10,id=1,title="acropolis"}
	}
 	local width=54+12
	local start_race_async

	-- record records (if any)
	for _,t in pairs(tracks) do
		local best_t=dget(t.id)
		-- empty/no records
		if(best_t>0) t.best_t=best_t
	end

	music(11, 250)
	return {
		-- draw
		draw=function()
			cls(13)
			camera(-t%8+8,-t%8+8)        
			for i=0,17 do
				for j=0,17 do
					if band(i+j,1)==1 then
						spr(119,i*8,j*8)
					end
				end
			end
			camera()
			if track_tgt==track and blink then
				rectfill(34,9,93,70,0xaa.0)
			end
			
			palt(0,false)
			local x=-width*track_tgt
			for i=1,#tracks do
				local s=tracks[i]
				sspr(s[1],s[2],54,56,flr(64+x-54/2),12,54,56)
				x+=width
			end
			if track_tgt==track then
				local s=tracks[track+1]
				printb(s.title,90-#s.title*4,61,7,5)
				printb(s.level,nil,74,s.c)
				-- track records				
				printb("track record",nil,88,7)
				printb(s.best_t and time_tostr(s.best_t) or "--'--''--",nil,96,10)
			end

			palt(14,true)
			--rectfill(28,98,100,120,0x11)
			--rectfill(29,99,99,119,0x77)

			for i=1,3 do
				pal(i,0)
			end
			local blink=flr(t/16)%3
			pal(blink+1,t%4<2 and 7 or 0)

			spr(78,8,90,2,3)
			local msgs={"â¬…ï¸âž¡ï¸"," âŽ"," ðŸ…¾ï¸"}
			pal()
			printb(msgs[blink+1],8,116,7) 

			if(t%32<16) printb("âŽ/ðŸ…¾ï¸ to race",nil,116,10,4)

			printb("â¬…ï¸ select track âž¡ï¸",28,2,7)            

		end,
		-- update
		update=function(self)
			if(start_race_async) start_race_async=corun(start_race_async)

			t+=1
			if(btnp(0)) track-=1
			if(btnp(1)) track+=1
			track=mid(track,0,#tracks-1)

			local k=track
  			track_tgt=lerp(track_tgt,k,0.18)
   			-- snap when close to target
			if abs(track_tgt-k)<0.01 then
				track_tgt=k
			end

			if not loading and (btnp(4) or btnp(5)) then
				-- avoid reentrancy bug
				loading=true
				-- snap track
				track_tgt=k
				-- sub-state
				start_race_async=cocreate(function()
					for i=1,15 do
						blink=i%2==0 and true
						yield()
					end
					music(-1,133)
					push_state(slidein_state,load_state,tracks[track+1].id)
				end)
			end
		end
	}
end

-- load track
function load_state(id)
	assert(id)
	return {
		draw=function()
		end,
		update=function()
			-- load track
			load("vracing_main.p8",nil,id)
		end
	}
end

function _init()
	cartdata("freds72_vracing")
	menuitem(1, "reset records", function() for i=0,3 do dset(i,0) end end)

	-- integrated fillp/color
	poke(0x5f34,1)

	unpack_models()

	-- restore map
	local map_str="cececececececececececececececececececececececececececececececececececececccdcecececececececececececccdccdcdccdcecececececececececcdcdcdcdcdcdccdcccdcecececececedcdcdcdcdcdcdcdcdcdccdcececececcdcdcdcdcdcdcdcdcdcdcdccdcccdccdcececececececececececececececececedededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededededed"
	local mem,k=0x2000,0
	for i=1,#map_str,2 do
		-- read bytes
		local b=tonum("0x"..sub(map_str,i,i+1))
		poke(mem,b)
		k+=1
		if k==16 then
			k=0
			mem+=128-15
		else
			mem+=1
		end
	end
	cam=make_cam()

	-- init state machine	
	push_state(title_state)
end

function _update()
	-- basic state mgt
	for state in all(states) do
		state:update()
	end
end

function _draw()
	for state in all(states) do
		state:draw()
	end

	--[[
	rectfill(0,0,127,6,8)
	print(stat(1),2,1,7)
	]]
end

-->8
-- unpack data & models
local mem=0x2000
function mpeek()
	local v=peek(mem)
	mem+=1
	return v
end

-- w: number of bytes (1 or 2)
function unpack_int(w)
  	w=w or 1
	local i=w==1 and mpeek() or bor(shl(mpeek(),8),mpeek())
	return i
end
-- unpack 1 or 2 bytes
function unpack_variant()
	local h=mpeek()
	-- above 127?
	if band(h,0x80)>0 then
		h=bor(shl(band(h,0x7f),8),mpeek())
	end
	return h
end
-- unpack a float from 1 byte
function unpack_float(scale)
	local f=shr(unpack_int()-128,5)
	return f*(scale or 1)
end
-- unpack a double from 2 bytes
function unpack_double(scale)
	local f=(unpack_int(2)-16384)/128
	return f*(scale or 1)
end
-- unpack an array of bytes
function unpack_array(fn)
	local n=unpack_variant()
	for i=1,n do
		fn(i)
	end
end
-- unpack a vector
function unpack_v(scale)
	return {unpack_double(scale),unpack_double(scale),unpack_double(scale)}
end

-- valid chars for model names
local itoa='_0123456789abcdefghijklmnopqrstuvwxyz'
function unpack_string()
	local s=""
	unpack_array(function()
		local c=unpack_int()
		s=s..sub(itoa,c,c)
	end)
	return s
end

function unpack_face()
	local f={flags=unpack_int(),c=unpack_int()}
	if(f.c==0x50) f.c=0x0150
	-- embedded fillp mode
	f.c+=0x1000.a5a5

	f.ni=band(f.flags,2)>0 and 4 or 3
	-- vertex indices
	-- quad?
	for i=1,f.ni do
		-- using the face itself saves more than 500KB!
		f[i]=unpack_variant()
	end
	return f
end

function unpack_model(model,scale)
	-- vertices
	local v=model.v
	unpack_array(function()
		add(v,unpack_v(scale))
	end)

	-- faces
	unpack_array(function()
		local f=unpack_face()
		-- inner faces?
		if band(f.flags,8)>0 then
			f.inner={}
			unpack_array(function()
				add(f.inner,unpack_face())
			end)
		end		
		-- normal
		f.n=v_cross(make_v(v[f[1]],v[f[f.ni]]),make_v(v[f[1]],v[f[2]]))
		v_normz(f.n)
		-- viz check
		f.cp=v_dot(f.n,model.v[f[1]])

		add(model.f,f)
	end)
end
function unpack_models()
	-- for all models
	unpack_array(function()
		local model,name,scale={lods={},lod_dist={}},unpack_string(),1/unpack_int()

		unpack_array(function()
			local d=unpack_double()
			assert(d<127,"lod distance too large:"..d)
			-- store square distance
			add(model.lod_dist,d*d)
		end)
  
		-- level of details models
		unpack_array(function()
			local lod={v={},f={},vgroups={}}
			unpack_model(lod,scale)
			-- unpack vertex groups (as sub model)
			unpack_array(function()				
				local name=unpack_string()
				local vgroup={offset=unpack_v(scale),f={}}
				-- faces
				unpack_array(function()
					local f=unpack_face()
					-- normal
					f.n=unpack_v()
					-- viz check
					f.cp=v_dot(f.n,lod.v[f[1]])

					add(vgroup.f,f)
				end)				
				lod.vgroups[name]=vgroup
			end)
		
			add(model.lods,lod)
		end)

		-- index by name
		all_models[name]=model
	end)
end

-->8
-- 3d
function collect_faces(faces,cam_pos,v_cache,out,dist)
	local n=#out+1
	for _,face in pairs(faces) do
		-- avoid overdraw for shared faces
		if face.session!=sessionid and (band(face.flags,1)>0 or v_dot(face.n,cam_pos)>face.cp) then
			local z,y,outcode,verts,is_clipped=0,0,0xffff,{},0
			-- project vertices
			for ki=1,face.ni do
				local a=v_cache[face[ki]]
				y+=a[2]
				z+=a[3]
				outcode=band(outcode,a.outcode)
				-- behind near plane?
				is_clipped+=band(a.outcode,2)
				verts[ki]=a
			end
			-- mix of near/far verts?
			if outcode==0 then
	   			-- average before changing verts
				y/=#verts
				z/=#verts
				-- mix of near+far vertices?
				if(is_clipped>0) verts=z_poly_clip(z_near,verts)
				if #verts>2 then
					out[n]={key=1/(y*y+z*z),f=face,v=verts,dist=dist}
				 	-- 0.1% faster vs [#out+1]
				 	n+=1
				end
			end
			face.session=sessionid	
		end
	end
end

local v_cache_cls={
	__index=function(t,k)
		-- relative to vgroup or base matrix			
		local a=m_x_v(t.m,t.v[k])
		
		-- world to cam
		local ax,az=a[1],a[3]
		local outcode=az>z_near and k_far or k_near
		if ax>az then outcode+=k_right
		elseif -ax>az then outcode+=k_left
		end	
		a={ax,a[2],az,outcode=outcode}

		t[k]=a
		return a
	end
}

function collect_model_faces(model,m,parts,out)
	-- all models reuses the same faces!!
	sessionid+=1
	
	-- vertex group matrix
	-- using close to avoid repeating the cache function
	local cam_pos=m_inv_x_v(m,cam.pos)
	
	-- select lod
	local d=v_dot(cam_pos,cam_pos)
	
	-- lod selection
	local lodid=0
	for i=1,#model.lod_dist do
		if(d>model.lod_dist[i]) lodid+=1
	end
	
	model=model.lods[min(lodid,#model.lods-1)+1]

	-- object to world
	-- world to cam
	m=m_x_m(cam.m,m)

	-- vertex cache (and model context)
	local v_cache={m=m,v=model.v}
	
	setmetatable(v_cache,v_cache_cls)

	-- main model
	collect_faces(model.f,cam_pos,v_cache,out)
	-- sub models
	local m_orig,m_base=m_clone(m),m_clone(m) 
	
	for name,vgroup in pairs(model.vgroups) do
		
		-- lookup vertex group orientation from parts
		local vgm=parts[name]

		-- cam to vgroup space
		-- note: cam_pos is already in object space
		local vg_cam_pos=m_inv_x_v(vgm,make_v(vgroup.offset,cam_pos))

		-- full vertex group vertex to cam transformation
		m_set_pos(m_base,m_x_v(m_orig,vgroup.offset))
		v_cache.m=m_x_m(m_base,vgm)

	 	collect_faces(vgroup.f,vg_cam_pos,v_cache,out)
	end
end

function draw_faces(faces,v_cache)
	for i=1,#faces do
		local d=faces[i]
		cam:project_poly(d.v,d.f.c)	
	end
end

function z_poly_clip(znear,v)
	local res={}
	local v0,v1,d1,t,r=v[#v]
	local d0=v0[3]-znear
 	-- use local closure
 	local clip_line=function()
 		local r,t=make_v(v0,v1),d0/(d0-d1)
 		v_scale(r,t)
 		v_add(r,v0)
 		res[#res+1]=r
 	end
	for i=1,#v do
		v1=v[i]
		d1=v1[3]-znear
		if d1>0 then
			if(d0<=0) clip_line()
			res[#res+1]=v1
		elseif d0>0 then
   			clip_line()
		end
		v0,d0=v1,d1
	end
	return res
end

-->8
-- print helpers
function padding(n)
	n=tostr(flr(min(n,99)))
	return sub("00",1,2-#n)..n
end

function time_tostr(t)
	if(t==32000) return "--"
	-- frames per sec
	local s=padding(flr(t/30)%60).."''"..padding(flr(10*t/3)%100)
	-- more than a minute?
	if(t>1800) s=padding(flr(t/1800)).."'"..s
	return s
end

-- bold print
function printb(s,x,y,c,c2)
	x=x or 64-shl(#s,1)
	local sy=c2 and -2 or -1
	for i=-1,1 do
        for j=sy,1 do
            print(s,x+i,y+j,0)
        end
    end
	if(c2) print(s,x,y,c2) y-=1
    print(s,x,y,c)
end

-- print sprite sx/sy at y on screen
-- x centered
-- perspective correct rotation by angle
function print3d(sx,sy,sw,sh,x,y,angle)
	local cc,ss=cos(angle),-sin(angle)
	local z0,z1=2+cc,2-cc
	-- projection
 	local x0,x1,w0,w1=-sw*ss/z0,sw*ss/z1,sh/z0,sh/z1
 	local c1,c2,inc=12,7,1
 	if(x0>x1)x0,x1,w0,w1,c1,c2,inc,sx=x1,x0,w1,w0,1,6,-1,sx+sw
 	pal(1,c1)
	pal(7,c2)
 	local len=x1-x0
	-- perspective correct mapping
	local u,du,dw=0,inc*sw*w1/len,(w1-w0)/len
	for x=x+x0,x+x1-0.5 do
		sspr(sx+u/w0,sy,1,sh,x,y-w0,1,2*w0)
 		u+=du
 		w0+=dw
	end
	pal()
end

__gfx__
33333333333bbbbbbbb33bbbbb3bb3bbbbbbb33b333333333333334f41333331111fff4333333333333333333344113113333333333300000000000000000000
33333333333bbbbb3333333b3bbbbbbbbbbbb3b333333333333333333ff5111115fff433333333333333333333f4411111133333333300000000000000000000
3333333333b3b3333333333333333333bb33bbbbb3b33333333333333333ffff4344333333133333333333333333fffffff13333333300000000000000000000
33333333bbbbb3333333333334f44333333333bbbb33333333333333333333333333333333131111111133333333344fffff3333333300000000000000000000
33333333bbbb333333366666666344f4343ff33bbbb33333333333333333333333333333333111111111331333333333333f3333333300000000000000000000
3333333bb3bb333360000000000000066634ff333333bbb333333333333333333333333333700000000d1111333333333f133333333300000000000000000000
3333333333bbb33600066666666000000066644f33333bbb33333333333333333333333337000d777d00d111333333333f133333333300000000000000000000
3333333333b3336006f111cccccccf336660006fffff33bbb33333333333333333333333d0075544f44d00d11133333333f13333333300000000000000000000
333333b33b33336006511c1c1ccfff3bb3360056fcccf333b33333333313333333333331d00d44ffffffd00d1113333333411333333300000000000000000000
33333b33bb33336006f1fff11cfb3bbb333f400ccc1cc333bbb333111111333333333311d00dcccccccccdd000d11333333f3333333300000000000000000000
3333333bb333336006ff33fff33bbbbb334419091cccc3bbbb3b33111111313333333311d00dcccccccccc4ddd0dd133333f3333333300000000000000000000
33333333bb333360063bb33b333333b33441190091cc33bbbbb333fff4111113333314ffd00dc1111cccccccf4d00d3333413333333300000000000000000000
5333333bbb33336006bbbbb333bb3bb344411190911c33bbb3b333cfff41111111114f88888888111111ccccffd00dd333f43333333300000000000000000000
f433333bbbb33360063bbb33b3bbb3334541119009cc5bbbb33333cccccff111554ffcc8d00d81111111cccccfd00dd333443333333300000000000000000000
c4f4533bbbbb3360063b33b3bbb333345f11111999ccf3bbb33333ccccccffffffffccc8d00d81111111111ccfd00dd331333333333300000000000000000000
cccf433bbbbb33600633bb3bbbb3333451111119091cc53bb33333c1cc1ccccffffcccc870078111111111cccf7007d341333333333300000000000000000000
1c1cff33bbb33360063bb33bbbb334ff41111119091ccf33b3333311111ccccccccccc18d00d8111111111cccfd00dd333f31333333300000000000000000000
1111cff3bb333360063bb3b3bb3b34fff11111199911c333b33b33111111c1cccc1cc1c8d00d8111111111cccfd00dd333f31333333300000000000000000000
1111ccfbbb333360063bb3bb33333343ff451119991cc33bbb3bb3111111111cc11c11187007811111111ccccf7007d333f41333333300000000000000000000
1111cccbbb33336006333b3333333333ff45111909ccf33bbbbb3311111111111c11111870078111111111cccf7007d333f13333333300000000000000000000
111ccc4b3b33336006333b33333344ff4445419009cf333b33333311111111111111111870078111111111cccf7007d344433333333300000000000000000000
c1c1c3b3b3333360063bbbb3b3334fff545f11909ccf333333333311111111111111111870078111111111cccf7007d34f133333333300000000000000000000
c43ccbbbb33333600633bbb33333f4f5f5f1190911ff3333333333111111111111111118700781111111111ccfd00dd4ff133333333300000000000000000000
33fcfbbbb33336600633bb33333345f11111909111cf443333354f111111111111111118d00d811111111111cc7007d441333333333300000000000000000000
334fbbbb333366600633bb33334f451111190091111cf4443344f4111111111111111118d00d811111111111ccd00dd4f5131333333300000000000000000000
b3bbbbbb333655000633b3334fff4f11119009111f11cccf45fccc11111111111111111870078111111111111cd00dd344113333333300000000000000000000
33bbbbbb33367500063bb334ffff441111909111f3f1c1ccfff1c11111111111111111187007811111111111ccd00dd344133333333300000000000000000000
3333bbbbb3367500063bbbb3334551111900911f33fc1cc1c11111111111111111111118700781111111111cccd00dd334133333333300000000000000000000
33333bbbb3365500063bbbbb3b355551190911133b3f4c44cc1111111111111111111118d00d81111111111cccd00dd334f13333333300000000000000000000
333333bbb336550006333bbb3bb3344f6009333bbbbb3333333f4c111111111111111188888888111111111cccd000d334ff3333333300000000000000000000
333333bbb336750005763b33bbbb3ff46006333bbbb3333333b3fc111111111111111111d00d1111111111cccc1d0003334f1333333300000000000000000000
333333bbb3365a0005763333bbbb33f3600633b33bb3333333bb33111111111111111111d000d111111111cccf133d0073331133333300000000000000000000
333333bb3336a60005763333333b333f3600633333bbbbbbbbbbbb111111111111111111d0000d1111111ccccc44337000734f4113330000eeeee11111eeeeee
333333bbb336aa0005763b333333bb3f46006333333bb333bb3bbb111111111111111111d00d0d1111111ccccc4f4437000d4ff413330000eee111111111eeee
333333bbb336aa00053333bbb33bbbb3f36006333333333333bbbb111111111111111111d00d0d1111111cccccff44f13d00dfff43330000ee1111eee1111eee
333333bbb336a600057633bbbbbbbbbb33360063333333333333bb111111111111111111d00d0d11111111cc1ccff4ff4d00d3fff3330000e111eeeeeee111ee
3333bbbb3336a600057633bbbbbbbbbbbb33600633333333333333111111111111111111d00d0d1111111111c1ccccfffd00d3ff51130000e11eeeeeeeee11ee
333bbbbbb336aa00053333bbb33333bbbb3f60064333334433333311111111111111111cd00d0d111111111111cccccf4d00d3fff1110000111eeeeeeeee111e
33bbbbbbb336aa00057633334fff43bbbb33f60563334f443334f31111111111111cccffd00d0d11111111111111cccf3d00d14ff1130000115511151115511e
33bbbbbbb336a60005763333fffff333b333f600633fff433333f3111111111111cccf44d00d0d1111111111111ccccf3d00d1fff1110000115511515115511e
33bbbbbb3336a600063333360000063f3ff436006ff33333bb3453111111111cccf44511d00d0d1111111111111cccf3d000d354f4410000115ee11511ee511e
33bbbbbb3336a600063b3f000666600633336006ff333bbbbbb34f1111111ccc44451111d00d0dc1cccccccc11cccffd000d3315f5140000111eee111eee111e
33bbbbbbb3635a00063b3f00634ff6006336006ff333b3bbbbb35f77d777dddd77dd113370070dccccccccc1c1cccf3d000d3154444f0000e11eeee1eeee11ee
333bbbb336335560063b34006f333f45000054f4333bb333bbb34f000000000000000d3370070dccffff4cccccccf3d000d315444fff0000e111eee5eee111ee
333bbbb3f3333360063334006f3b33f450054f3333b333333bb33477d777dddd77d00d337007dfff4f4f4fcccccffd0000d15444ff440000ee11115551111eee
33bbb333f3333360063b3400733bb3b3ffff3bb3333333333bbb331111ccf445111d0dd0700731151111544fcccf3d0000d3544444440000eee111111111eeee
33bbb333f333336006333f006f33bbb33443b3bbb333333333bbb3cccccf4411113d0d007007311133331111fcff5d0d00d3144445540000eeeee11111eeeeee
3bbbb333f333336006333f00634433bbbbbbbbbb3b3333333b3bbbffff411111333d0007d00d3333d0000d3155111d0d00d3555511540000eeeeeeeeeeeeeeee
3bbbb333f333336006333f00633443bbbb3bbbbb3bb33333333bbbff45513113333d00d3d00d3337000000d15111d00700d3111531140000ee2222eeee3333ee
333bb333f3333360064f43006333f43bbbb3bb33333333333333bb4511133333333d00d3d00d3d000d333d00d3d00d1d00d3333333330000e255552ee355553e
3333bb33ff333360006660006334f3bbbb333b33333333333333331111113333333d00d3d00d3d00d333333d0000000d00d0000000000000e222222ee333333e
33333bb34f33333600000006333bf33bbb333b3b3333333333b33b1113333333333d00d3d00d3d00d3333333d000000d00d0000000000000e255552ee355553e
333bbbb33f3333336666666333bf433bb333333333333333333b333333333333333d00d3d00d3d00d33333333333333d00d3333333330000e222222ee333333e
33333b3334f3333333333333334f33bbb333bb33333333333333333333333333333d0007d00d7000d33333333333333d00d3333333330000e222222eee3333ee
33333333334f33333333333334f3333b333b33333333333333333333333333333333d000d00d000d333333333333333d00d3333333330000e222222eeeeeeeee
333333333334f433333333334f4333333333333333333333333333333333333333333dd0d00d0dd3333333333333333d00d3333333330000ee2222eeeeeeeeee
66666fffffff6ffff6666666444444466ffffff6ff6666666666660077777777000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
66666ffffff6fffff4466444444444466f66fff6666fff6666ff660066666667000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
666f6ff6466f44444444444466666644466646ff66666ff666ffff0066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
66666f6466644454444444666666664444444ff666f66666666fff0066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
66666f6444445554666666666666f6644444446f6fff66f6f666ff0066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
6f666ff444555446666446666666664466645544f666f64666ff6f0066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
ff6666444454446f664444444444444444644544f6646664666fff0066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
666ff66644466666644445555554455554666444444444444444660066666666000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee
6ffff6ff444666664445555555555555544666445444544455444608880000000888088800000000000080000000000000000000000000000000000000000000
ffff66ff4466666f4445560000000000644666644444444555554400888000008880088800000000008880000000000000000000000000000000000000000000
ffff6fff446f64664444600000000000064466664444446444554400888000008880000000000000008880000000000000000000000000000000000000000000
46f66f44466f64444460063333333366006446646666666666445400888800088880088800888088088888800888000888000088888800000000000000000000
6666f4444666644447006336666666f6006444644466664666644400088800088800088800888880088888800888000888000888888880000000000000000000
4446644446444447007336666666ffff600644444444445644466600088800088800088800888000008880000888000888008880008880000000000000000000
4444446666644600733666f6666f46ff660064445555555544446600088880888800088800888000008880000888000888000000888880000000000000000000
444444666644600733666f633336f46f646006667777766555444600008880888000088800888000008880000888000888000888888880000000000000000000
4444466644600633666f630000003464444600000000000065544400008880888000088800888000008880000888000888008888008880000000000000000000
44446664460063366666300066003444444466666666666006544400000888880000088800888000008880000888000888008880008880000000000000000000
666666444600666666430063360034444446fccccccccccc60064400000888880000088800888000008888800888888888008888888880000000000000000000
6666644446006f66664300733700364446fccccccccccccc60064400000888880000088800888000000888800088880888000888808880000000000000000000
4446464446006f6f6443007337003fcccccccccccccccccc60075508888888800000000000000000000000000888000000000000000000000000000000000000
4444444556006ffff443007337003fcccccccccccccccccc60075508888888880000000000000000000000000888000000000000000000000000000000000000
4444445337007fff6443006337003fcccccccccccccccccc60065508880008880000000000000000000000000000000000000000000000000000000000000000
5553333bb6006fff4443006337003fccccccccccccccccc006545408880008880000088888800000888880000888008880888800000888088800000000000000
33333bbbb6006fff46f6300636003fcccccccccccccccc6065444408880008880000888888880008888888000888008888888880008888888800000000000000
b3bbbbbb6000744446ccf630050036fcccccccccccccc60644444408888888800008880008880088880088800888008880008880088800888800000000000000
bbbbbbbb6000744446cccf630060036fccccccccccccc60654444408888888000000000888880088800000000888008880008880088800088800000000000000
bbb3775005007444466fcccf630060036fccccccccccc60755544408880088800000888888880088800000000888008880008880088800088800000000000000
bbb37750050076f66ffcccccf630060036fcccccccccc60754444408880088800008888008880088800000000888008880008880088800088800000000000000
bbb37750050076ccccccccccccf630060036fcccccccc60654444608880008880008880008880088880088800888008880008880088800888800000000000000
bbb33330050076cccccccccccccf630060036fccccccf60644666608880008880008888888880008888888000888008880008880008888888800000000000000
bbb37750050076cccccccccccccccf630060036fffb3300544666608880000888000888808880000888880000888008880008880000888088800000000000000
bbb37750050066cccccccccccccccccf630060033330065554444600000000000000000000000000000000000000000000000000000000088800000000000000
bbb33330050076ccccccccccccccccccf63006006600634544446600000000000000000000000000000000000000000000000000088888888000000000000000
bbb37750050076cccccccccccccccccccc6b30060063333444446600000000000000000000000000000000000000000000000000008888880000000000000000
bbb37750050066ccccccccccccccccccccf6b3006637333444666600000000000000000000000000000000000000000000000000000000000000000000000000
bbb33336000076cccccccccccccccccccccfb6003733335466666600000000000000000000000000000000000000000000000000000000000000000000000000
33bbb333600066ccccccccccccccccccccfb60067333333446666600000000000000000000000000000000000000000000000000000000000000000000000000
43555444360066cccccccccccccccccccc6006733b33335444466400000000000000000000000000000000000000000000000000000000000000000000000000
454444453600666ccccccccccccccccccc600633b333335544444400000000000000000000000000000000000000000000000000000000000000000000000000
66466444436006366ccccccccccccccccc7007bbbbbb3335444555000777777700777777000077777000777700000000cccccccccccccccccccccccc00000000
444446644553600736cccccccccccccccc7007b33344b333535333007111111177111111700711117007111170000000cccccc7777cccccccccccccc00000000
4444444444453700636ccccccccccccccc60063343555533333333007111111177111111707111117071111117000000ccccc7777777cccccccccccc00000000
44466444464433360063666666ccccccf360063544444453333333007117771170771177071117777711177111700000cccc777777777ccccccccccc00000000
6666f4444664433360066776666ccccf3600633544444453333333007117771170071170071170000711700711700000cc777777777777cccccccccc00000000
666f6ff44466644453600000000677660065544466444445333333007111111170071170071170000711700711700000c7777777777777cccccccccc00000000
fff6ffff4466664444366776600000000654444446f44443333333007111111170071170071170000711700711700000c77777777777777ccccccccc00000000
f6fff6ff44666666455555555466776645444666666644444543330071177777000711700711700007117007117000007777777777777777cccccccc00000000
fffff6ff446666664445555555333333554446444666446445433300711700000077117707111777771117711170000077777777cccccccc0000000000000000
666ff6664444666f6444444555444455544454444664444445433300711700000711111170711111707111111700000077777777cccccccc0000000000000000
6f666f6444554445666446644446644446544544f644444644354300711700000711111170071111700711117000000077777777777777770000000000000000
66666ff44445544455f6466666666666644444444646644466445300077000000077777700007777700077770000000077777777777777770000000000000000
66666f64444455555446666666664666454444444664644646464400000000000000000000000000000000000000000077777777777777777777000000000000
66666644444444555546666664666464444446664664664446466500000000000000000000000000000000000000000077777777777777777777770000000000
6666f66f666ff644444444444644464454466f646666646444444400000000000000000000000000000000000000000077777777777777777777777000000000
66666f6ff6f6fffff444444444444444444446666666f44464544600000000000000000000000000000000000000000077777777777777777777777700000000
000000000000000000000000000000000000000000000000000000001111111111111eee00000000000000000000000066666666333333330000000000000000
000000000000000000000000000000000000000000000000000000001777177717771eee0000000000000000000000006d6d6d6d333333330000000000000000
000000000000000000000000000000000000000000000000000000001a0a1aaa111a1eee00000000000000000000000036363636333333330000000000000000
000000000000000000000000000000000000000000000000000000001999191919991eee00000000000000000000000033333333333333330000000000000000
000000000000000000000000000000000000000000000000000000001212121212111eee00000000000000000000000033333333333333330000000000000000
000000000000000000000000000000000000000000000000000000001818181818881eee00000000000000000000000033333333333333330000000000000000
000000000000000000000000000000000000000000000000000000001111111111111eee00000000000000000000000033333333333333330000000000000000
00000000000000000000000000000000000000000000000000000000eeeeeeeeeeeeeeee00000000000000000000000033333333333333330000000000000000
__label__
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111117777777777777111111111111111117777777777777111111111111111177777777777777777777777777771111111111111111111111111111111111
11111111777777777777111111111111111117777777777771111111111111111177777777777777777777777777777771111111111111111111111111111111
11111111777777777777111111111111111117777777777771111111111111111177777777777777777777777777777777711111111111111111111111111111
11111111777777777777711111111111111177777777777771111111111111111177777777777777777777777777777777771111111111111111111111111111
11111111177777777777711111111111111177777777777711111111111111111177777777777777777777777777777777777111111111111111111111111111
11111111177777777777711111111111111177777777777711111111111111111177777777777777777777777777777777777711111111111111111111111111
11111111177777778887771111888188811777777777787711111111111111111177777777777777777777777777777777777711111111111111111111111111
11111111117777777888771118880088801777777778880111111111111111111177777777777777777777777777777777777771111111111111111111111111
11111111117777777888071118880110001777777778880111111111111111111177777777777777777777777777777777777771111111111111111111111111
11111111111777777888877188880188817888788788888811888111888111188888877777777711111111111777777777777771111111111111111111111111
11111111111777777788807188800188807888880088888801888011888011888888887777777711111111111117777777777771111111111111111111111111
11111111111777777788807188801188807888000778880001888011888018880008880777777711111111111117777777777771111111111111111111111111
11111111111177777788887888801188807888077778880111888011888011000888880777777711111111111117777777777771111111111111111111111111
11111111111177777778880888001188807888077778880111888011888011888888880777777711111111111177777777777771111111111111111111111111
11111111111177777778880888011188807888077778880111888011888018888008880777777711111111117777777777777771111111111111111111111111
11111111111117777777888880011188807888077778880111888011888018880078880777777777777777777777777777777711111111111111111111111111
11111111111117777777888880111188807888077778888811888888888018888888880777777777777777777777777777777711111111111111111111111111
11111111111117777777888880111188807888077771888801188880888011888808880777777777777777777777777777777111111111111111111111111111
11111111111111777777700000111110007700077771100001110000100011100007000777777777777777777777777777771111111111111111111111111111
11111111111111777777777777111117777777777771111111111111111111111177777777777777777777777777777777711111111111111111111111111111
11111111111111177777777777111117777777777711111111111111111111111177777777777777777777777777777777111111111111111111111111111111
11111111111111177777777777111117777777777711111111111888888881111177777777777777777777788877777711111111111111111111111111111111
11111111111111177777777777711177777777777711111111111888888888111177777777777777777777788807771111111111111111111111111111111111
11111111111111117777777777711177777777777111111111111888000888011177777777777777777777770007777111111111111111111111111111111111
11111111111111117777777777711177777777777111111111111888011888011178888887777788888777788877888788881111188818881111111111111111
11111111111111117777777777711777777777771111111111111888011888011188888888777888888877788807888888888111888888880111111111111111
11111111111111111777777777771777777777771111111111111888888880011888000888078888008887788807888000888018880088880111111111111111
11111111111111111777777777771777777777771111111111111888888800111100088888078880011000788807888077888018880118880111111111111111
11111111111111111177777777771777777777711111111111111888008881111188888888078880111111788807888077888018880118880111111111111111
11111111111111111177777777777777777777711111117777777888018880111888800888078880111111188807888077888018880118880777777711111111
11111111111111111177777777777777777777711111117777777888011888111888007888078888118881188807888077888018880188880777777711111111
11111111111111111117777777777777777777111111117777777888011888011888888888077888888800188807888077888011888888880777777711111111
11111111111111111117777777777777777777111111117777777888011188811188880888077788888001188807888077888011188808880777777711111111
11111111111111111117777777777777777777111111117777777700011110001170000700077710000011110007700077700011110008880777777711111111
11111111111111111111777777777777777771111111117777777777711111111177777777777711111111111177777777777778888888800777777711111111
11111111111111111111777777777777777771111111117777777777711111111177777777777711111111111177777777777771888888007777777711111111
11111111111111111111177777777777777711111111117777777777711111111177777777777711111111111117777777777777100000077777777711111111
11111111111111111111177777777777777711111111117777777777711111111177777777777711111111111117777777777777711117777777777711111111
11111111111111111111177777777777777711111111117777777777711111111177777777777711111111111111777777777777711117777777777711111111
11111111111111111111117777777777777111111111117777777777711111111177777777777711111111111111177777777777771117777777777711111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

__map__
03030e0c1d1a0150000175415c405543a8415c40e74284415c40324284415c403243a83ea4403243a83ea4403242843ea440e742843ea4405543a840e440ae3c9040e440903bae40e441cf3bae40e441cf3c903f1c41cf3bae40e640e73c903f1a40e73c903f1a41953bae40e641953bae40e641953c903f1a41953c903f1c41
cf3c903f1c40903bae3f1c40ae3c9040e640e73bae3f1a40e73bae3f9a40003f5b3f9a408f3fae4066408f40524066408f3fae3f9a3f713fae40663f714052406640003f5b40663f713fae3f9a3f7140524066400040a53f9a400040a53f9a408f40523f8040cc3ebc3fd4417a3e98408040cc3ebc404d40de40bd4000404843
903eb240a33e96408a4021403440b040213d343f5040213d34414e40a33e963ede40b53f94407c40623c063f0040923d98414e40213e8c3eb240213e8c412240b53f943ede40213f943f76402140343f9f40de4034401e41923f893f8640d53f893faf40a13d343f0040213d833f8440623c06410040923d98406140de403440
5140a13d343fe241923f89407a40d53f89400041323d6c402c417a3e983fb340de40bd412240213f944000409b3bf0410040213d83406640003f5b4066408f3fae3f9a408f40523f9a408f3fae40663f713fae3f9a3f7140523f9a40003f5b3f9a3f713fae40663f7140523f9a400040a54066400040a54066408f40523f9a40
003f5b3f9a408f3fae4066408f40524066408f3fae3f9a3f713fae40663f714052406640003f5b40663f713fae3f9a3f7140524066400040a53f9a400040a53f9a408f4052406640003f5b4066408f3fae3f9a408f40523f9a408f3fae40663f713fae3f9a3f7140523f9a40003f5b3f9a3f713fae40663f7140523f9a400040
a54066400040a54066408f40523e1d40003bdb41e340003bdb3e1d40003d2541e340003d253e1d400040db41e3400040db3e1d4000422541e340004225402d410140833fd3410140832f0311010203040311050607080388090a0b0c0388140d151603280e17180f03771011121300663f2743001144282900772e343e00772a
253700283c463a0088302c3f02662e3d473202663245342e02662a2f35330266333b312a001630463c02772a313a250077372f2a0200452b3e3402002f373635026636374429020038413940026629283e2b02883a313b2d00283f463000883a2d3c02553c2d2c3002882c473d3f02553941284400772e3e270277273f3d2e00
66253a260028423a460028463f4202773840264300884326420266432741380088423f43026625264039008842263a03770306050403506c6d6f6e03507071737202cc4428747500cc28417400cc44753904031d1d22417e40903c800a025561606a6b408040004000020561636660400040403f910255626966633f80400040
0002556a60646840804000400002556066676440003fc03f910255656766693f804000400002056467656840003f80400002556865696a40003fc0406f02056a69626b40004040406f02556b626361400040804000031711223e82409041800a02551a2423193f804000400002051a191f1c400040403f9102551b1c1f224080
40004000025523211d193f80400040000255191d201f40003fc03f9102551e221f2040804000400002051d211e2040003f80400002552123221e40003fc0406f020523241b2240004040406f0255241a1c1b40004080400003171d223e8240903c800a0255555f5e543f8040004000020555545a57400040403f91025556575a
5d40804000400002555e5c58543f8040004000025554585b5a40003fc03f910255595d5a5b4080400040000205585c595b40003f80400002555c5e5d5940003fc0406f02055e5f565d40004040406f02555f555756400040804000031d1122417e409041800a0255494852534080400040000205494b4e48400040403f910255
4a514e4b3f8040004000025552484c504080400040000255484e4f4c40003fc03f9102554d4f4e513f804000400002054c4f4d5040003f8040000255504d515240003fc0406f020552514a5340004040406f0255534a4b49400040804000051f1d0c0e1601015000016c3f094001400040f9400140003ebe401040003ed94000
40003d3e402f400040f9400142013f094001420141434010400042c1402f400042c1403041ff3ed9400441ff412a400040003e31405f40d53e65401541173e9e405f41603e65413541173dfd4071405d3e45401540683e83407140713e45416340683c10408440513c32402a40b33c57407441013c32415840b23d3440824083
3d69402a40c23da4406e410d3d69411040c641e14060407141bb400f40c841944052411f41bb414340c842d4404f41c942fc4011418a43254050415642fc416b41873ed9400543ff4143401041ff3d3e401f41fe3ebe401041fe4129400441ff4143401043ff3c7a408242543cb4402a428f3cf4406d42e03cb4415d42963d44
408442373d7e402a42853dbf406e42cb3d7e4113428441f8404b42c641ae40174305415f404b434a41ae412e43054242406e41d742244017421e41ff406e427442244147421e4353404643d3437740114397439c4040435d43774178438742874050439742aa4011436942cd4048432742aa4153436443d2404842f543ea4011
42bc43ff4048426e43ea417142ae3f094001440140f94001440141434010460042c1402f43ff3d3e402f43fe3ebe401143fe3ebe401046003ed84004460041294004460040f9400146004129400543ff3db4405d44033dc1400c44493dd1405d448b3dc1414c44493e4a404f44c03e73400c44f43eab404f453d3e73411e44f4
3d7e408244a13da7402a44e93dd44089453d3da7415144e93c94408143a33cc8402a43f03d02406744263cc8414e43f541ed405044d341bc401944f7418f4050451f41bc412f44f7426e405045a9428f4011457a42af4050452f428f414145773f094001460042c1402f46003d3d402f460028023b070b040103dd0607010202
332608090a023b2705032802992803040b0233020c29060299290c082603b30d0e0f100333111213140335151617180335191a1b1c03b31d1e1f20033521222324023b47250b07036d48470706023b2a260a4a02334b27284c02494c280b2502330629514802995129262a03352b2c2d2e03352f30313203b33334353603bb37
38393a03353b3c3d3e03353f40414203354344454602336a4e25470366506a4748023b492a4a6b023b6c4b4c4d02994d4c254e023b48514f5002494f512a4903bb5253545503335657585903bb5a5b5c5d03355e5f606103b3626364650335666768690008180c1d161419121e01015000011c3f2f4001400040cf400140003f
2f400142013f34400140003ffe400141633ffe400140c34004400140c340044001416340d4400140003ffe400143453ffe400142a54004400142a54004400143453f34400142013f344001440140cf4001440140cf4001420140d44001420140d4400144013f2f400146003f2f400144013ffe400145273ffe40014487400440
01448740044001452740cf4001460040d4400146003f34400146000903770301040e03770506070803771102091203770a0b0c0d037715030e0f037710111213037714150f1c03771617181903771a10131b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001007009070116600d6500d040090300703005020040200301002010010100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200001a370123503664021630146200d620086200661005610046100361003610026101e600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010400003c64524620246102461024600246002460018600186001860018600186000c6000c6000c6000c60000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101000024375183751867018660186601865018650186500c6400c6400c6400c6400c6300c6300c6200c6250c600003000030000300003000030000300003000030000300003000030000300003000030000300
010800080c7700c7700c7700c7700c7700c7700c7700c7700c7000c7000c7000c7000c7000c7000c7000c70000700007000070000700007000070000700007000070000700007000070000700007000070000700
010800000c0730c500070000500004000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800040c4500c4500c4500c45000400004000040000400004000040000400004000040000400004000040000400004000040000400004000040000400004000040000400004000040000400004000040000400
010200003c62500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010c00000000000000000000000000000000000000000000195501a5501c5501e5502055021550235502555025550255502555025550255502555025550255502555025550255502555025550255502555025550
010c00001887018870188731887318873188701887318873189701897318973189732487024873208702087320870208702087020870208702087020870208702087020870208702087020870208702087020870
010c00000405004050040550400004050040550405004055040500405004055040000405004055040500405504050040500405504000040500405504050040550405004050040550400004050040550605006055
010c000026540265402654026540265402654525540255402554025545215402154021540215452554025540255402554026540255402354023540235402354023540235451c5401c5451e5401e5451f5401f540
010c0000215402154021540215402154021545215402154021540005051c5401c5401c54000505215402154021540215401e5401e545205402054020540205402054020545205002050020500205001a5401a540
010c00001887018870188701887018630186151860018600189701897018970189701863018615186001860018870188701887018870186301861518600186001897018970189701897018630186151860018600
010c00000705007050070550700007050070550705007055090500905009055090000905009055090500905506050060500605506000060500605506050060550b0500b0500b0550b0000b0500b0550b0500b055
010c00001f5401f5401f5401f54021540215401e5401e5401e5401e5451a5401a5401a5401a5451e5401e5401e5401e5401f5401e5401c5401c5401c5401c540195401a5401c5401e54020540215402354025540
010c00001a5401a5401a5401a5401a5451a50019540195401954019545155401554015540155451a5401a5401a5401a5401a5401a5451a5401a5401a5401a5401a5401a5451551017510195101a5101c5101e510
010c00001887018870188701887018630186151860018600189701897018970189701863018615186001860018870188701887018870186301861518970189731897318970189731897024870248702087020870
010c0000188701887018870188701863018615186001860018970189701897018970186301861518600186001887018870188701887018630186151860018600248702487320870208731d8701d8731b8701b873
010300002787027870278702787027873278702787027870278732787027870278702787327870278702787024870248702487024870248732487024870248702087020870208702087020873208702087020870
010c00000b0500d0500f0501005012050140501505017050170501705017050170501705017050170501705017050170501705017050170501705017050170501705017050170501705017050170501705017050
010c00001a5501b5501d5501f55021550225502455026550265502655026550265502655026550265502655026550265502655026550265502655026550265502655026550265502655026550265502655026550
010c00000505005050050550500005050050550505005055050500505005055050000505005055050500505505050050500505505000050500505505050050550505005050050550500005050050550705007055
010c000027540275402754027540275402754526540265402654026545225402254022540225452654026540265402654027540265402454024540245402454024540245451d5401d5451f5401f5452054020540
010c0000225402254022540225402254022545225402254022540005051d5401d5401d54000505225402254022540225401f5401f545215402154021540215402154021545215002150021500215001b5401b540
010c000008050080500805508000080500805508050080550a0500a0500a0550a0000a0500a0550a0500a05507050070500705507000070500705507050070550c0500c0500c0550c0000c0500c0550c0500c055
010c00002054020540205402054022540225401f5401f5401f5401f5451b5401b5401b5401b5451f5401f5401f5401f540205401f5401d5401d5401d5401d5401a5401b5401d5401f54021540225402454026540
010c00001b5401b5401b5401b5401b5451b5001a5401a5401a5401a545165401654016540165451b5401b5401b5401b5401b5401b5451b5401b5401b5401b5401b5401b54516510185101a5101b5101d5101f510
010c0000195501a5501c5501e55020550215502355025550255502555025550255502555025550255502555025550255502555025550255502555025550255502555025550255502555025550255502555025550
010600001863018630186201862018610186100060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600006000060000600
010c000000000000000000000000000000000000000000000b0500d0500f050100501205014050150501705017050170501705017050170501705017050170501705017050170501705017050170501705017050
01160000207401b730197301b7101e7401e7201e710197301b7401e7401e7101b7301e7201e7301b7401e740207401b730197301b7101e7401e7201e710197301b7401e7401e7101b7301e7201e7301b7401e740
011600000dc600dc500dc400fc500fc400fc3008c5008c4008c3008c300ac400ac000bc500bc000ac400ac000bc500bc400bc300dc500dc400dc3012c5012c4012c3012c2012c2012c1012c1012c1012c5514c55
011600000d0500d0300d0200f0300f0200f010080300802008010080100a0200a0000b0300b0000a0200a0000b0300b0200b0100d0300d0200d01012030120201201012010120151200012000120001203014030
0116000018d7018f2030f1018d7030f1018f1018d7018f1030f1030f1018d7030f1018d7030f1018d7030f1018d7018f2030f1018d7030f1018f1018d7018f1024a3018a5018d7018d5024a3018a5018d7030f10
01160000080000800008000080001e7551b735197351e7501e7401b7551e7501b7551e750207502074020730207202071518700187001e7551b735197351e7501e7401b7551e750207501a750197551775017730
011600000dc500dc400dc300fc500fc400fc3008c5008c4008c3008c300ac400ac000bc500bc000ac400ac000bc500bc400bc300dc500dc400dc3006c5006c4006c3006c2006c2006c1006c1006c1012c5514c55
011600000d0300d0200d0100f0300f0200f010080300802008010080100a0200a0000b0300b0000a0200a0000b0300b0200b0100d0300d0200d01006030060200601006010060151200012000120001203014030
0116000018d7030f103cf2030f102490030f103cf2030f1018d7030f103cf2030f102462530f103cf2018d701861530f1018d70309002462530f103cf1030f1018d7030f1018d703090018b7024b6018b7030614
011600000805008040080300802008010080100801008010080200802008020080200801008010080100801008020080200802008020080100801008010080100802008020080200802008010080100802008030
0116000008c5008c4008c3008c2036c5533c3531c3536c5036c4033c5536c5033c5536c5038c5038c4038c3038c2038c1508c2008c2036c5533c3531c3536c5036c4033c5536c5038c5032c5031c552fc502fc30
0116000018d703090024f2018d700000024f1018d7018f100000024f2018d7018f1018d7024f2018d7018f1018d703090024f2018d700000024f1018d7018f101880018f1018d700cd7024a4018d7018f1024f10
01160000246552460524600246552460030600246552460024600246002465524600246553c600246552400024655300003000024655300002460024655000002460024600000000000024655246000000000000
011600000de500de400de300fe500fe400fe3008e5008e4008e3008e300ae400ae000be500be000ae400ae000be500be400be300de500de400de3012e5012e4012e3012e2012e2012e1012e1012e1006e4508e25
011600001945019440194301b4501b4401b430144501444014430144301644016400174501740016440164001745017440174301945019440194301e4501e4401e4301e4201e4201e4101e4101e4100644508425
0116000018d7018f2024f3018d702465518f2018d7018f200cf2018f2018d7018f202465518f2018d7018f2018d7018f2024f3018d702465518f2018d7018f200cf2018f2024d4018d702465518d7024f3018f20
01160000257502574025730277502774027730207502074020730207302274022700237502370022740227002375023740237302575025740257302a7502a7402a7302a7202a7202a7102a7102a7100670008700
0116000008e4008e4008e3008e2008e1508e2508e3512e5012e4008e3512e5008e4512e5014e5014e5014e4008e2008e1008e4008e3008e1508e2508e3512e5012e4008e3512e5014e400ee500de500be500be40
01160000084400844008430084200841508425084351e4501e440084351e450084451e450204502045020440084200841008440084300841508425084351e4501e440084351e450204401a450194501745017440
0116000018d7030f103cf2030f102465530f103cf2030f1018d7030f103cf2030f102465530f103cf2018d701861530f1018d70309002465530f103cf1030f1018d7030f1018d70309002465524b5030b6630614
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000400021f100081001b1000e100251001f1002b100000002a1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200001b05014000230400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 1d1e0809
01 0a0b0c0d
00 0e0f1011
00 0a0b0c0d
00 0e0f1012
00 13141540
00 1617180d
00 191a1b11
00 1617180d
00 191a1b12
02 13141c40
00 1f202122
00 1f242522
00 23272826
00 23272826
00 2a2b2c29
00 552b2c2d
00 232f3031
00 232f3031
00 2e2b2c2d
00 2e2b2c2d
00 232f3031
02 232f3031

